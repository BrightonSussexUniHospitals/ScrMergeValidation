SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

--CREATE SCHEMA Merge_R_Compare AUTHORIZATION dbo

CREATE VIEW [Merge_R_Compare].[VwSCR_Warehouse_SCR_Referrals]
AS

SELECT		mer.[CARE_ID]
			,5 AS [SrcSysID]
			,ss.[SrcSysCode]
			,ss.[SrcSysName]
			,mer.[PatientPathwayID]
			,mer.[PatientPathwayIdIssuer]
			,mer.[PATIENT_ID]
			,mer.[MainRefActionId]
			,mer.[DiagnosisActionId]
			,mer.[DemographicsActionId]
			,mer.[Forename]
			,mer.[Surname]
			,mer.[DateBirth]
			,mer.[HospitalNumber]
			,mer.[NHSNumber]
			,mer.[NHSNumberStatusCode]
			,mer.[NstsStatus]
			,mer.[IsTemporaryNHSNumber]
			,mer.[DeathStatus]
			,mer.[DateDeath]
			,mer.[PctCode]
			,mer.[PctDesc]
			,mer.[CcgCode]
			,mer.[CcgDesc]
			,mer.[CancerSite]
			,mer.[CancerSiteBS]
			,mer.[CancerSubSiteCode]
			,mer.[CancerSubSiteDesc]
			,mer.[ReferralCancerSiteCode]
			,mer.[ReferralCancerSiteDesc]
			,mer.[ReferralCancerSiteBS]
			,mer.[CancerTypeCode]
			,mer.[CancerTypeDesc]
			,mer.[PriorityTypeCode]
			,mer.[PriorityTypeDesc]
			,mer.[SourceReferralCode]
			,mer.[SourceReferralDesc]
			,mer.[ReferralMethodCode]
			,mer.[DecisionToReferDate]
			,mer.[TumourStatusCode]
			,mer.[TumourStatusDesc]
			,mer.[PatientStatusCode]
			,mer.[PatientStatusDesc]
			,mer.[PatientStatusCodeCwt]
			,mer.[PatientStatusDescCwt]
			,mer.[ConsultantCode]
			,mer.[ConsultantName]
			,mer.[InappropriateRef]
			,mer.[TransferReason]
			,mer.[TransferNewRefDate]
			,mer.[TransferTumourSiteCode]
			,mer.[TransferTumourSiteDesc]
			,mer.[TransferActionedDate]
			,mer.[TransferSourceCareId]
			,mer.[TransferOrigSourceCareId]
			,mer.[FastDiagInformedDate]
			,mer.[FastDiagExclDate]
			,mer.[FastDiagCancerSiteID]
			,mer.[FastDiagCancerSiteOverrideID]
			,mer.[FastDiagCancerSiteCode]
			,mer.[FastDiagCancerSiteDesc]
			,mer.[FastDiagEndReasonID]
			,mer.[FastDiagEndReasonCode]
			,mer.[FastDiagEndReasonDesc]
			,mer.[FastDiagDelayReasonID]
			,mer.[FastDiagDelayReasonCode]
			,mer.[FastDiagDelayReasonDesc]
			,LEFT(CAST(mer.[FastDiagDelayReasonComments] AS VARCHAR(8000)),8000) AS [FastDiagDelayReasonComments]
			,mer.[FastDiagExclReasonID]
			,mer.[FastDiagExclReasonCode]
			,mer.[FastDiagExclReasonDesc]
			,mer.[FastDiagOrgID]
			,mer.[FastDiagOrgCode]
			,mer.[FastDiagOrgDesc]
			,mer.[FastDiagCommMethodID]
			,mer.[FastDiagCommMethodCode]
			,mer.[FastDiagCommMethodDesc]
			,mer.[FastDiagOtherCommMethod]
			,mer.[FastDiagInformingCareProfID]
			,mer.[FastDiagInformingCareProfCode]
			,mer.[FastDiagInformingCareProfDesc]
			,mer.[FastDiagOtherCareProf]
			,mer.[FDPlannedInterval]
			,mer.[DateDiagnosis]
			,mer.[DateNoCancer]
			,mer.[AgeAtDiagnosis]
			,mer.[DiagnosisCode]
			,mer.[DiagnosisSubCode]
			,mer.[DiagnosisDesc]
			,mer.[DiagnosisSubDesc]
			,mer.[OrgIdDiagnosis]
			,mer.[OrgCodeDiagnosis]
			,mer.[OrgDescDiagnosis]
			,mer.[SnomedCT_ID]
			,mer.[SnomedCT_MCode]
			,mer.[SnomedCT_ConceptID]
			,mer.[SnomedCT_Desc]
			,mer.[Histology]
			,mer.[DateReceipt]
			,mer.[AgeAtReferral]
			,mer.[AppointmentCancelledDate]
			,mer.[DateConsultantUpgrade]
			,mer.[DateFirstSeen]
			,mer.[OrgIdUpgrade]
			,mer.[OrgCodeUpgrade]
			,mer.[OrgDescUpgrade]
			,mer.[OrgIdFirstSeen]
			,mer.[OrgCodeFirstSeen]
			,mer.[OrgDescFirstSeen]
			,mer.[OrgCodeMainCurrent]
			,mer.[OrgDescMainCurrent]
			,mer.[FirstAppointmentTypeCode]
			,mer.[FirstAppointmentTypeDesc]
			,mer.[FirstAppointmentOffered]
			,mer.[ReasonNoAppointmentCode]
			,mer.[ReasonNoAppointmentDesc]
			,mer.[FirstSeenAdjTime]
			,mer.[FirstSeenAdjReasonCode]
			,mer.[FirstSeenAdjReasonDesc]
			,mer.[FirstSeenDelayReasonCode]
			,mer.[FirstSeenDelayReasonDesc]
			,LEFT(CAST(mer.[FirstSeenDelayReasonComment] AS VARCHAR(8000)),8000) AS [FirstSeenDelayReasonComment]
			,mer.[DTTAdjTime]
			,mer.[DTTAdjReasonCode]
			,mer.[DTTAdjReasonDesc]
			,mer.[IsBCC]
			,mer.[IsCwtCancerDiagnosis]
			,mer.[UnderCancerCareFlag]
			,mer.[RefreshMaxActionDate]
			,mer.[ReportDate]
			,mer.[DateLastTracked]
			,mer.[DaysSinceLastTracked]
			,mer.[RTTBreachStatus]
			,mer.[DelayReasonCode]
			,mer.[DelayReasonDesc]
			,LEFT(CAST(mer.[DelayReasonComment] AS varchar(8000)),8000) AS [DelayReasonComment]
			,mer.[SharedBreach]
			,mer.[PredictedBreachYear]
			,mer.[PredictedBreachMonth]
			,mer.[LateralityCode]
			,mer.[LateralityDesc]
			,mer.[ClinicalTStage]
			,mer.[ClinicalNStage]
			,mer.[ClinicalMStage]
			,mer.[ClinicalTNM_Group]
			,mer.[PathologicalTStage]
			,mer.[PathologicalNStage]
			,mer.[PathologicalMStage]
			,mer.[PathologicalTNM_Group]
			,mer.[FIGO_Stage1]
			,mer.[FIGO_Stage2]
			,mer.[FIGO_Stage3]
			,mer.[RISS_Stage]
			,mer.[AnnArborStageCode]
			,mer.[AnnArborStageDesc]
			,mer.[BinetStageCode]
			,mer.[BinetStageDesc]
			,mer.[CNSIndicatorCode]
			,mer.[MaxWHO_Status]
			,mer.[IsCOSD_Staging]
			,mer.[IsCOSD_StagingComplete]
			,mer.[IsCOSD_PerformanceStatus]
			,mer.[IsCOSD_PerformanceStatusComplete]

FROM		CancerReporting_MERGE.SCR_Warehouse.SCR_Referrals mer

LEFT JOIN	CancerReporting_MERGE.LocalConfig.SourceSystems ss
														ON ss.SrcSysID = 5
GO
